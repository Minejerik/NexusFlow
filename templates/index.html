<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>NexusFlow</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" >
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" ></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>
	<style>
body {
    background:#eee;
}

a {
  color: inherit;
}
		
.posts-content{
    margin-top:20px;    
}
.ui-w-40 {
    width: 40px !important;
    height: auto;
}
.default-style .ui-bordered {
    border: 1px solid rgba(24,28,33,0.06);
}
.ui-bg-cover {
    background-color: transparent;
    background-position: center center;
    background-size: cover;
}
.ui-rect {
    padding-top: 50% !important;
}
.ui-rect, .ui-rect-30, .ui-rect-60, .ui-rect-67, .ui-rect-75 {
    position: relative !important;
    display: block !important;
    padding-top: 100% !important;
    width: 100% !important;
}
.d-flex, .d-inline-flex, .media, .media>:not(.media-body), .jumbotron, .card {
    -ms-flex-negative: 1;
    flex-shrink: 1;
}

#admin{
  background-color: lightgreen;
  border-radius: 5px;
  display: inline;
  padding: 3px;
}

.bg-dark {
    background-color: rgba(24,28,33,0.9) !important;
}
.card-footer, .card hr {
    border-color: rgba(24,28,33,0.06);
}
.ui-rect-content {
    position: absolute !important;
    top: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    left: 0 !important;
}
.default-style .ui-bordered {
    border: 1px solid rgba(24,28,33,0.06);
}
		
	</style>
</head>
<body>
<script>
        async function send(id) {
          const error = document.getElementById("error");
          const resp = await fetch("/api/like", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body:
              "id=" +
              encodeURIComponent(id),
          });
          const text = await resp.text();
					const obj = JSON.parse(text)
					if (obj.error == false){
						location.reload()
					}
				}
	      async function del(id) {
          const resp = await fetch("/api/deletepost", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body:
              "id=" +
              encodeURIComponent(id),
          });
          const text = await resp.text();
					const obj = JSON.parse(text)
					if (obj.error == false){
						location.reload()
					} else {
						document.write(obj.error)
					}
				}
        async function edit(id) {
          const but = document.getElementById("editbut"+id);
          but.remove()
          const content = document.getElementById("content"+id);
          while (content.firstChild) {
            content.removeChild(content.firstChild);
          }
          const input = document.createElement("textarea");
          const resp = fetch("/api/getpost", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body:
              "id=" +
              encodeURIComponent(id),
          })
            .then((response) => response.json())
            .then((json) => {
              input.value = json.post; // set current value of the textarea
            });
          input.setAttribute("id", "content-text"+id);
          input.setAttribute("class", "form-control");
          const button = document.createElement("button");
          button.setAttribute("class", "btn btn-primary");
          button.setAttribute("onclick", "editpost('" + id + "')");
          button.innerHTML = "Submit";
          content.appendChild(input);
          content.appendChild(button);
        }

        async function editpost(id) {
          const content = document.getElementById("content-text"+id).value;
          const resp = await fetch("/api/editpost", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body:
              "id=" +
              encodeURIComponent(id) +
              "&content=" +
              encodeURIComponent(content),
          });
          const text = await resp.text();
          const obj = JSON.parse(text);
          if (obj.error == false) {
            location.reload();
          } else {
            document.write(obj.error);
          }
        }

	      document.addEventListener("DOMContentLoaded", function(event) { 
            var scrollpos = localStorage.getItem('scrollpos');
            if (scrollpos) window.scrollTo(0, scrollpos);
        });

        window.onbeforeunload = function(e) {
            localStorage.setItem('scrollpos', window.scrollY);
        };
</script>
{% set user = myuser %}
{% include "header.html" %}

{% for i in range(posts|length) %}
{% set post = posts[i] %}
{% set create = creates[i] %}
{% if post.isreply == False %}
<div class="container posts-content">
    <div class="row">
        <div class="col-lg-6">
            <div class="card mb-4">
              <div class="card-body">
                <div class="media mb-3">
                  <div class="d-flex align-items-center">
                    <img src="{{create['pfpurl']}}" class="d-block ui-w-40 rounded-circle" alt=""> &nbsp;&nbsp;
                    <div class="media-body ml-3">
                      <a href="/u/{{create['name']}}">{{create['name']}}{% if create.admin == True %} </a> <div id="admin">Admin</div> {% else%} </a> {% endif %}
                    </div>&nbsp;&nbsp;&nbsp;&nbsp;
                    <div class="text-muted small">{{post['date_created']}} &nbsp;&nbsp; {% if create['public_id'] == myuser['public_id'] and  post['del_allow'] == True or myuser['admin'] ==True %}<a href="javascript:del('{{post['pub_id']}}')" style="color: red;"> Delete Post</a>&nbsp;&nbsp;<a href="javascript:edit('{{post['pub_id']}}')" style="color: blue;" id="editbut{{post['pub_id']}}"> Edit Post</a>{% endif %}</div>
                  </div>
                </div>
                <div id="content{{post['pub_id']}}">
                <p id="content-text{{post['pub_id']}}">
									{{post['content']|markdown}}
                </p>
                </div>
<!--                 <a href="javascript:void(0)" class="ui-rect ui-bg-cover" style="background-image: url('https://bootdey.com/img/Content/avatar/avatar3.png');"></a> -->
              </div>
              <div class="card-footer">
                <a href="javascript:send('{{post['pub_id']}}')" class="d-inline-block text-muted">
                    
                  {% if post['pub_id'] in likes %}
                  <strong>{{post['likes']}}</strong> Liked
              {% else %}
                  <strong>{{post['likes']}}</strong> Likes
              {% endif %}
                </a>
                <a href="/p/{{post['pub_id']}}" class="d-inline-block text-muted ml-3">
                    <strong>{{post['comments']}}</strong> Comments
                </a>
                &nbsp;&nbsp;
                {% if post['edited'] == True %}
                    <strong>Edited</strong>
                {% endif %}
              </div>
            </div>
        </div>
</div>
</div>
{% endif %}
{% endfor %}

<h1 style="padding-left:150px;">No More Posts Found</h1>
</body>
</html>